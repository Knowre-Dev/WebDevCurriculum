# Quest 06. 인터넷의 이해

## Introduction

- 이번 퀘스트에서는 인터넷이 어떻게 동작하며, 서버와 클라이언트, 웹 브라우저 등의 역할은 무엇인지 알아보겠습니다.

## Topics

- 서버와 클라이언트, 그리고 웹 브라우저
- 인터넷을 구성하는 여러 가지 프로토콜
  - IP
  - TCP
  - HTTP
- DNS

## Resources

- [OSI 모형](https://ko.wikipedia.org/wiki/OSI_%EB%AA%A8%ED%98%95)
- [IP](https://ko.wikipedia.org/wiki/%EC%9D%B8%ED%84%B0%EB%84%B7_%ED%94%84%EB%A1%9C%ED%86%A0%EC%BD%9C)
  - [Online service Traceroute](http://ping.eu/traceroute/)
- [TCP](https://ko.wikipedia.org/wiki/%EC%A0%84%EC%86%A1_%EC%A0%9C%EC%96%B4_%ED%94%84%EB%A1%9C%ED%86%A0%EC%BD%9C)
  - [Wireshark](https://www.wireshark.org/download.html)
- [HTTP](https://ko.wikipedia.org/wiki/HTTP)
  - Chrome developer tool, Network tab
- [DNS](https://ko.wikipedia.org/wiki/%EB%8F%84%EB%A9%94%EC%9D%B8_%EB%84%A4%EC%9E%84_%EC%8B%9C%EC%8A%A4%ED%85%9C)
  - [Web-based Dig](http://networking.ringofsaturn.com/Tools/dig.php)

## Checklist

- 인터넷은 어떻게 동작하나요? Internet Protocol Suite의 레이어 모델에 입각하여 설명해 보세요.
  <img src="http://cfile23.uf.tistory.com/image/213F623C566BAE253BF7A8">
  <img src="https://t1.daumcdn.net/cfile/tistory/995EFF355B74179035">

  ```
    nternet Protocol Suite는 인터넷에서 컴퓨터들이 서로 정보를 주고받는 데 쓰이는 통신규약(Protocol)의 모음이다.
    Internet Protocol Suite 중 TCP와 IP가 가장 많이 쓰이기 때문에 TCP/IP Protocol suite라고도 불린다.

    TCP/IP
    TCP/IP는 패킷 통신 방식의 인터넷 프로토콜인 IP(Internet Protocol)와 전송 조절 프로토콜인 TCP(Transmission Control Protocol)로 이루어져 있다.
    IP는 패킷 전달 여부를 보증하지 않고, 패킷을 보낸 순서와 받는 순서가 다를 수 있다(Unreliable datagram service).
    TCP는 IP에서 동작하는 프로토콜로, 데이터의 전달을 보증하고 보낸 순서대로 받게 해준다.

    1계층 - 물리계층(Physical Layer)
    이 계층에서는 주로 전기적, 기계적, 기능적인 특성을 이용해서 통신 케이블로 데이터를 전송하게 된다.
    이 계층에서 사용되는 통신 단위는 비트이며 이것은 1과 0으로 나타내어지는, 즉 전기적으로 On, Off 상태라고 생각하면 된다.
    이 계층에서는 단지 데이터를 전달만 할뿐 전송하려는(또는 받으려는)데이터가 무엇인지, 어떤 에러가 있는지 등에는 전혀 신경 쓰지 않는다.
    단지 데이터 전기적인 신호로 변환해서 주고받는 기능만 할 뿐이다. 이 계층에 속하는 대표적인 장비는 통신 케이블, 리피터, 허브등이 있다.

    2계층 - 데이터 링크계층(DataLink Layer)
    물리계층을 통해 송수신되는 정보의 오류와 흐름을 관리하여 안전한 정보의 전달을 수행할 수 있도록 도와주는 역할
    이 계층에서는 맥 주소를 가지고 통신하게 된다. 이 계층에서 전송되는 단위를 프레임이라고 하고, 대표적인 장비로는 브리지, 스위치가 있다.
    -> 브릿지나 스위치를 통해 맥주소를 가지고 물리계층에서 받은 정보를 전달함.

    데이터 링크 계층(Data link layer)은 포인트 투 포인트(Point to Point) 간 신뢰성있는 전송을 보장하기 위한 계층으로
    CRC 기반의 오류 제어와 흐름 제어가 필요하다. 네트워크 위의 개체들 간 데이터를 전달하고,
    물리 계층에서 발생할 수 있는 오류를 찾아 내고, 수정하는 데 필요한 기능적, 절차적 수단을 제공한다.
    주소 값은 물리적으로 할당 받는데, 이는 네트워크 카드가 만들어질 때부터 맥 주소(MAC address)가 정해져 있다는 뜻이다.
    주소 체계는 계층이 없는 단일 구조이다. 데이터 링크 계층의 가장 잘 알려진 예는 이더넷이다.
    이 외에도 HDLC나 ADCCP 같은 포인트 투 포인트(point-to-point) 프로토콜이나
    패킷 스위칭 네트워크나 LLC, ALOHA 같은 근거리 네트워크용 프로토콜이 있다.
    네트워크 브릿지나 스위치 등이 이 계층에서 동작하며, 직접 이어진 곳에만 연결할 수 있다.
    -> 프레임에 주소부여(MAC - 물리적주소)
       에러검출/재전송/흐름제어

    3계층 - 네트워크 계층(Network Layer)
    데이터를 목적지까지 가장 안전하고 빠르게 전달하는 기능(라우팅)이다. 여기에 사용되는 프로토콜의 종류도 다양하고, 라우팅하는 기술도 다양하다.
    이 계층은 경로를 선택하고 주소를 정하고 경로에 따라 패킷을 전달해주는 것이 이 계층의 역할
    이 계층의 대표적인 장비는 라우터 이며, 요즘은 2계층의 장비 중 스위치라는 장비에 라우팅 기능을 장착한 Layer 3 스위치도 있다.(여기서 IP주소를 사용한다.)
    -> 주소부여(IP), 경로설정(Route)

    3-1 IP계층
    TCP/IP 상에서 IP 계층이란 네트워크의 주소 (IP 주소)를 정의하고, IP 패킷의 전달 및 라우팅을 담당하는 계층

    IP 계층의 주요 역할
    - IP 계층에서는 그 하위계층인 데이터링크 계층의 하드웨어적인 특성에(즉, ATM 이 든 Frame Relay 이든 상관없이) 관계없이 독립적인 역할을 수행

    IP 계층 상에 있는 주요 프로토콜
    - 패킷의 전달을 책임지는 IP
    - 패킷 전달 에러의 보고 및 진단을 위한 ICMP
    - 복잡한 네트워크에서 인터네트워킹을 위한 경로를 찾게해주는 라우팅 프로토콜

    3-2 IP 프로토콜
    TCP/IP 기반의 인터넷 망을 통하여 데이타그램의 전달을 담당하는 프로토콜
    1. 주요 기능
    IP 계층에서 IP 패킷의 라우팅 대상이 됨 (Routing)
    IP 주소 지정 (Addressing)

    2.주요 특징
    - `신뢰성(에러제어)` 및 `흐름제어`  기능이 전혀 없음  ☞ Best-Effort Service
    - 한편, 신뢰성을 확보하려면 IP 계층 위의 TCP와 같은 상위 트랜스포트 계층에 의존
    - 비연결성 데이터그램 방식으로 전달되는 프로토콜        ☞ Connectionless
    - 패킷의 완전한 전달(소실,중복,지연,순서바뀜 등이 없게함)을 보장 않음  ☞ Unreliable
    - IP 패킷 헤더 내 수신 및 발신 주소를 포함  ☞ IPv4 헤더, IPv6 헤더, IP 주소
    - IP 헤더 내 바이트 전달 순서 : 최상위 바이트(MSB)를 먼저 보냄  ☞ Big-endian
    - 경우에따라, 단편화가 필요함  ☞ IP 단편화 참조
    - TCP, UDP, ICMP, IGMP 등이 IP 데이타그램에 실려서 전송

    4계층 - 전송 계층(Transport Layer)
    통신을 활성화하기 위한 계층이다. 보통 TCP프로토콜을 이용하며, 포트를 열어서 응용프로그램들이 전송을 할 수 있게 한다.
    만약 데이터가 왔다면 4계층에서 해당 데이터를 하나로 합쳐서 5계층에 던져 준다.
    단대단 오류제어 및 흐름제어 이 계층 까지는 물리적인 계층에 속한다.(TCP/UDP프로토콜을 사용한다.)
    전송 계층(Transport layer)은 양 끝단(End to end)의 사용자들이 신뢰성있는 데이터를 주고 받을 수 있도록 해 주어, 상위 계층들이 데이터 전달의 유효성이나 효율성을 생각하지 않도록 해준다.
    시퀀스 넘버 기반의 오류 제어 방식을 사용한다.
    전송 계층은 특정 연결의 유효성을 제어하고, 일부 프로토콜은 상태 개념이 있고(stateful), 연결 기반(connection oriented)이다.
    이는 전송 계층이 패킷들의 전송이 유효한지 확인하고 전송 실패한 패킷들을 다시 전송한다는 것을 뜻한다.
    가장 잘 알려진 전송 계층의 예는 TCP이다.
    -> 패킷 생성(Assembly/Sequencing/Deassembly/Error detection/Request repeat/Flow control) 및 전송

    5계층 -세션 계층(Session Layer)
    데이터가 통신하기 위한 논리적인 연결을 말한다. 통신을 하기위한 대문이라고 보면 된다.
    하지만 4계층에서도 연결을 맺고 종료할 수 있기 때문에 우리가 어느 계층에서 통신이 끊어 졌나 판단하기는 한계가 있다.
    그러므로 세션 계층은 4 계층과 무관하게 응용 프로그램 관점에서 봐야 한다.
    세션 설정, 유지, 종료, 전송 중단시 복구 등의 기능이 있다.
    동시 송수신 방식(duplex), 반이중 방식(half-duplex), 전이중 방식(Full Duplex)의 통신과 함께, 체크 포인팅과 유휴, 종료, 다시 시작 과정 등을 수행한다.
    이 계층은 TCP/IP 세션을 만들고 없애는 책임을 진다.
    -> 통신하는 사용자들을 동기화하고 오류복구 명령들을 일괄적으로 다룬다.
       통신을 하기 위한 세션을 확립/유지/중단 (운영체제가 해줌)

    6계층 - 표현 계층(Presentation Layer)
    데이터 표현이 상이한 응용 프로세스의 독립성을 제공하고, 암호화 한다.
    표현 계층(Presentation layer)은 코드 간의 번역을 담당하여 사용자 시스템에서 데이터의 형식상 차이를 다루는 부담을 응용 계층으로부터 덜어 준다.
    MIME 인코딩이나 암호화 등의 동작이 이 계층에서 이루어진다.
    해당 데이터가 TEXT인지, 그림인지, GIF인지 JPG인지의 구분 등이 표현 계층의 몫이다.
    -> 사용자의 명령어를 완성및 결과 표현. 포장/압축/암호화

    7계층 - 응용 계층(Application Layer)
    최종 목적지로서 HTTP, FTP, SMTP, POP3, IMAP, Telnet 등과 같은 프로토콜이 있다.
    해당 통신 패킷들은 방금 나열한 프로토콜에 의해 모두 처리되며 우리가 사용하는 브라우저나, 메일 프로그램은 프로토콜을 보다 쉽게 사용하게 해주는 응용프로그램이다. 한마디로 모든 통신의 양 끝단은 HTTP와 같은 프로토콜이지 응용프로그램이 아니다.
    -> 네트워크 소프트웨어 UI 부분, 사용자의 입출력(I/O)부분

    HTTP 프로토콜(HyperText Transfer Protocol)
    웹 상에서 웹 서버 및 웹브라우저 상호 간의 데이터 전송을 위한 응용계층 프로토콜
    처음에는, WWW 상의 하이퍼텍스트 형태의 문서를 전달하는데 주로 이용
    현재에는, 이미지,비디오,음성 등 거의 모든 형식의 데이터 전송 가능
  ```

  - 근거리에서 서로 떨어진 두 전자기기가 유선/무선으로 서로 통신하는 프로토콜은 어떻게 동작할까요?

    > 근거리는 보통 정적 라우팅을 통해 연결되며 라우팅 테이블에 저장된 두 기기의 IP와PORT정보를 통해 데이터 전달 와이파이를 이용한다면 무선 공유기를 통한 라우팅/ 블루투스를 이용한다면 BLE stack 프로토콜을 이용한다.

  - 근거리에 있는 여러 대의 전자기기가 서로 통신하는 프로토콜은 어떻게 동작할까요?

  > LAN을 통해서 통신

  - 아주 멀리 떨어져 있는 두 전자기기가 유선/무선으로 서로 통신하는 프로토콜은 어떻게 동작할까요?

  > 아주 먼 거리에 있는 전자기기에 대해 라우팅 테이블을 작성할 수 없으므로 Hob(지역 통신사)를 통한 데이터 전달

  - 두 전자기기가 신뢰성을 가지고 통신할 수 있도록 하기 위한 프로토콜은 어떻게 동작할까요?

    > 보통 멀리 떨어져 있는 기기의 경우엔 근거리 대역의 네트워크가 없어 라우팅 테이블 작성이 어려우므로, 인터넷과 같이 Hob(지역 통신사)를 통한 데이터 전달이 이루어진다.

  - HTTP는 어떻게 동작할까요?

  ```
    HTTP는 요청(Request)와 응답(Response)로 구성되어 있고, 클라이언트가 요청을 하면 서버가 응답을 하는 구조
    HTTP는 FTP나 텔넷과는 다르게 비연결식이다. FTP나 Telnet은 클라이언트가 서버에 정보를 요청해도 서버가 클라이언트와 연결을 끊지 않지만,
    HTTP는 클라이언트가 서버에 정보를 요청하면 응답 코드와 내용을 전송하고 클라이언트와 연결을 종료

    ex) 클라이언트가 어느 홈페이지에 접속 -> 클라이언트는 GET명령을 접속한 서버에 전송 -> GET요청을 받은 서버는 응답 코드와 메시지를 전송하고 그것을 브라우저에 뿌려준다.
  ```

- 우리가 브라우저의 주소 창에 www.knowre.com 을 쳤을 때, 어떤 과정을 통해 서버의 IP 주소를 알게 될까요?

```
    1. 네트워크 서비스 제공회사의 DNS 서버에 도메인이름을 요청
    2. DNS 서버는 knowre의 DNS 서버에 www라는 컴퓨터의 IP주소를 요청
    3. knowre의 DNS 서버는 DNS zone file에서 www 컴퓨터의 IP 주소를 찾아서 알려준다
    4. DNS서버는 요청한 클라이언트에 IP주소를 알려준다.
```

## Quest

- tracert(Windows가 아닌 경우 traceroute) 명령을 통해 www.google.com 까지 가는 경로를 찾아 보세요.
  - 어떤 IP주소들이 있나요?
  - 그 IP주소들은 어디에 위치해 있나요?
- Wireshark를 통해 www.google.com 으로 요청을 날렸을 떄 어떤 TCP 패킷이 오가는지 확인해 보세요
  - TCP 패킷을 주고받는 과정은 어떻게 되나요?
  - 각각의 패킷에 어떤 정보들이 담겨 있나요?
- telnet 명령을 통해 http://www.google.com/ URL에 HTTP 요청을 날려 보세요.
  - 어떤 헤더들이 있나요?
  - 그 헤더들은 어떤 역할을 하나요?

## Advanced

- HTTP의 최신 버전인 HTTP/3는 어떤 식으로 구성되어 있을까요?
- TCP/IP 외에 전세계적인 네트워크를 구성하기 위한 다른 방식도 제안된 바 있을까요?
