# Quest 11. RDB의 기초와 ORM

## Introduction

- 이번 퀘스트에서는 데이터베이스를 다루는 방법에 대해 알아보겠습니다.

## Topics

- RDBMS
- MySQL
- ORM
- Hash
  - scrypt

## Resources

- [MySQL 101 – The basics](https://www.globo.tech/learning-center/mysql-101-basics/)
- [Sequelize](https://sequelize.org/)
- [안전한 패스워드 저장](https://d2.naver.com/helloworld/318732)

## Checklist

- RDBMS 테이블의 정규화는 무엇인가요?

> 흔히 DB라고 알고 있는 RDBMS(Relational DataBase Management System)를 설계할 때, 중복을 최소화하면서 데이터 구조를 짜는 프로세스이다.

- MySQL 외의 RDB에는 어떤 것들이 있나요?

> Oracle: 대규모 트랜잭션 처리 및 엔터프라이즈급 기능을 지원하는 상용 데이터베이스 관리 시스템이다.
> Microsoft SQL Server: Microsoft사에서 개발한 관계형 데이터베이스 관리 시스템으로, Windows 환경에서 자주 사용한다.
> PostgreSQL: 오픈소스이며, MySQL과 비교해 표준 SQL 기능을 더 많이 지원하고 있다.
> SQLite: 파일기반의 경량 데이터베이스 관리 시스템으로, 임베디드 시스템에서의 사용이 적합하다.
> MongoDB: NoSQL 데이터베이스 관리 시스템으로, JSON과 유사한 BSON 형식으로 데이터를 저장한다. 문서기반의 구조를 가지고 있어 유연한 데이터 모델링이 가능하다.

- Relational Database 외에 다른 DB에는 어떤 것들이 있을까요?

  > NoSQL 데이터베이스: NoSQL 데이터베이스는 스키마가 없는 데이터 모델을 사용한다. NoSQL 데이터베이스는 데이터의 복잡성이나 확장성이 높은 애플리케이션에 적합하다. 예를 들어, MongoDB, Cassandra, Redis 등이 있다.

  > 그래프 데이터베이스: 그래프 데이터베이스는 노드(node)와 엣지(edge)로 이루어진 그래프 모델을 사용한다. 그래프 데이터베이스는 관계형 데이터베이스에서의 복잡한 쿼리를 더 간단하게 처리할 수 있다. 예를 들어, Neo4j, ArangoDB 등이 있다.

  > 컬럼 패밀리 데이터베이스: 컬럼 패밀리 데이터베이스는 컬럼 단위로 데이터를 저장하고 검색하는 방식을 사용한다. 컬럼 패밀리 데이터베이스는 빅데이터와 같은 대규모 데이터를 다루는 데 특히 적합하다. 예를 들어, Apache HBase, Apache Cassandra 등이 있다.

  > 메모리 데이터베이스: 메모리 데이터베이스는 데이터를 디스크가 아닌 메모리에 저장한다. 이를 통해 매우 빠른 데이터 액세스 속도를 제공한다. 예를 들어, Redis, Memcached 등이 있다.

  > 객체 데이터베이스: 객체 데이터베이스는 객체 지향 프로그래밍에서 사용되는 객체를 직접 저장하고 검색할 수 있다. db4o, ObjectDB 등이 있다.

- RDBMS에서 테이블의 인덱싱은 무엇인가요? 인덱싱을 하면 어떤 점이 다르며, 어떤 식으로 동작하나요?

> RDBMS에서 인덱싱(Indexing)은 검색 속도를 높이기 위한 기술로, 테이블에 저장된 데이터의 특정 열(Column)에 대한 검색 속도를 높여주는 자료 구조를 생성하는 것을 말한다.
> 인덱싱을 하면 데이터를 검색할 때 전체 테이블을 모두 검색하지 않고 인덱스 구조를 활용하여 더 빠르게 검색할 수 있습니다. 인덱스는 트리 구조로 저장되며, 이진 검색 트리(Binary Search Tree) 또는 B+트리(B+Tree) 등 다양한 알고리즘을 사용하여 생성한다. 인덱스를 생성할 때는 검색 빈도가 높은 열에 대해서 생성하면 좋다. 예를 들어, 회원 정보 테이블에서 회원 아이디나 회원 이메일과 같은 식별자 열은 검색 빈도가 높기 때문에 인덱스를 생성하면 검색 속도가 빨라진다. 하지만 인덱스를 생성하면 그만큼 데이터 저장 공간도 늘어나기 때문에 적절한 선별과 사용이 필요하다.
> 인덱스를 사용하면 검색 속도가 빨라지지만, 인덱스를 생성하고 유지하는 데에는 일정한 비용이 들기 때문에 데이터 수정이 빈번하게 일어나는 테이블에서는 인덱스를 생성하지 않는 것이 성능 향상에 도움이된다. 또한, 인덱스를 생성할 때 열의 카디널리티(Cardinality, 해당 열에 서로 다른 값의 개수)를 고려해야한다. 카디널리티가 높은 열은 인덱스를 생성해도 효과가 크지 않을 수 있다.

- ORM을 사용하는 것은 사용하지 않는 것에 비해 어떤 장단점을 가지고 있나요?

> 장점:

> SQL 쿼리 작성 및 관리의 간소화: ORM은 객체지향 프로그래밍에서 사용하는 방식으로 데이터를 조작할 수 있으므로 SQL 쿼리를 직접 작성하는 것보다 쉽고 직관적이다. ORM을 사용하면 개발자는 데이터베이스에 대한 세부 정보를 알 필요가 없어지므로 개발 속도가 빨라질 수 있다.
> 이식성: ORM은 데이터베이스에 대한 일반적인 인터페이스를 제공하므로 다양한 데이터베이스에서 사용할 수 있다. 따라서 개발자는 특정 데이터베이스에 종속되지 않고 이식성이 높은 코드를 작성할 수 있다.
> 유지보수성: ORM은 일반적으로 추상화된 데이터 모델을 사용하므로 변경이 필요한 경우 코드의 수정 범위가 줄어든다. 또한 ORM은 대부분의 CRUD(Create, Read, Update, Delete) 작업을 자동으로 처리하므로 코드의 반복이 줄어든다.

> 단점:

> 성능: ORM은 데이터베이스 연산을 수행하기 위해 추가적인 추상화 계층을 거치므로 일부 작업에서는 성능이 저하될 수 있다. 특히 대규모 데이터 처리와 같이 성능이 중요한 작업에서는 주의가 필요하다.

> 학습 곡선: ORM을 처음 사용하는 개발자에게는 학습 곡선이 있을 수 있다. ORM은 일반적으로 복잡한 기능을 제공하며, 개발자가 데이터베이스 연산을 직접 수행하는 것보다 ORM의 추상화 계층을 이해하고 사용하는 데 시간이 걸릴 수 있다.

> 제한된 기능: ORM은 대부분의 CRUD 작업을 처리할 수 있지만, 일부 고급 기능(예: 저장 프로시저 호출)은 ORM을 사용하여 구현하기 어렵거나 불가능할 수 있다. 이러한 경우에는 직접 SQL 쿼리를 작성해야 할 수도 있다.

- 자바스크립트 생태계의 ORM에는 어떤 것들이 있나요?

> Sequelize: Node.js용 ORM이며, MySQL, PostgreSQL, SQLite 등의 RDBMS를 지원한다.
> TypeORM: TypeScript로 작성된 ORM으로, MySQL, PostgreSQL, SQLite, Microsoft SQL Server 등을 지원한다.
> Prisma: TypeScript 기반의 ORM이며, PostgreSQL, MySQL, SQLite, Microsoft SQL Server 등을 지원한다.
> Mongoose: MongoDB를 위한 ODM(Object Document Mapping)으로, MongoDB의 데이터를 자바스크립트 객체로 다룰 수 있도록 해준다.
> Waterline: MongoDB, MySQL, PostgreSQL, Redis, Elasticsearch 등 다양한 데이터베이스를 지원하는 ORM이다.
> Bookshelf: PostgreSQL, MySQL, SQLite3를 지원하는 ORM으로, Knex.js와 함께 사용한다.

- 모델간의 1:1, 1:N, N:M 관계는 각각 무엇이고 어떨 때 사용하나요?

> 1:1 관계 (One-to-One Relationship) 1:1 관계는 한 테이블의 레코드가 다른 테이블의 레코드와 하나의 관계만 가지는 경우를 말한다. 예를 들어, 사용자 테이블과 주소 테이블이 있다고 가정하면, 한 사용자는 하나의 주소만 가지며, 주소 레코드도 한 사용자만 참조할 수 있다.
> 1:N 관계 (One-to-Many Relationship) 1:N 관계는 한 테이블의 레코드가 다른 테이블의 여러 레코드와 관계를 맺을 수 있는 경우를 말한다. 예를 들어, 사용자 테이블과 주문 테이블이 있다고 가정하면, 한 사용자는 여러 주문을 가질 수 있지만, 주문 레코드는 한 사용자만 참조할 수 있다.
> N:M 관계 (Many-to-Many Relationship) N:M 관계는 두 개 이상의 테이블이 서로의 레코드를 여러 개 가질 수 있는 경우를 말한다. 예를 들어, 학생 테이블과 강의 테이블이 있다고 가정하면, 한 학생은 여러 강의를 들을 수 있으며, 한 강의도 여러 학생이 수강할 수 있다. 이 경우, 두 테이블 간의 관계를 나타내는 중간 테이블이 필요한다.

- DB에 사용자의 암호를 평문으로 저장하지 않고도 사용자의 암호를 인증하는 것이 가능한 이유는 무엇일까요?

> DB에 사용자의 암호를 평문으로 저장하지 않는 이유는 보안상의 이유이다. 만약 DB에 평문으로 저장된 암호가 노출되면, 해당 사용자의 모든 정보가 해킹될 수 있다. 따라서, 대부분의 웹 어플리케이션에서는 사용자의 암호를 해시(hash) 함수를 이용하여 암호화하여 저장한다. 해시 함수는 일방향 함수이므로, 암호화된 값에서 원래 값을 복원할 수 없다. 이를 이용하여, 사용자가 로그인할 때 입력한 암호를 다시 해시하여 DB에 저장된 암호화된 값과 비교하여 인증을 수행한다.
> 또한, 안전한 인증을 위해 추가적으로 솔트(salt)와 같은 기술을 이용하기도 한다. 솔트는 암호화할 때 입력한 암호와 함께 랜덤한 값을 결합하여 해시하는 방식이다. 이렇게 함으로써, 동일한 암호를 입력해도 솔트값이 다르므로, 암호화된 값도 서로 다른 값이 생성됩니다. 이를 이용하여, 무차별 대입 공격(brute force attack)을 방지하고, 보다 안전한 인증이 가능하다.

- 해시 함수에는 어떤 것이 있나요?

> 해시 함수는 임의의 길이의 데이터를 고정된 길이의 데이터로 매핑하는 함수다. 주어진 입력에 대해 항상 동일한 출력을 반환하며, 입력 값이 조금이라도 달라지면 완전히 다른 출력 값을 반환이다. 일반적으로 해시 함수는 암호화를 목적으로 하는 알고리즘과는 달리, 역으로 추적하기 어렵도록 고정된 길이의 출력 값을 생성하도록 설계한다. 일반적으로 사용되는 해시 함수로는 SHA (Secure Hash Algorithm) 계열과 MD (Message Digest) 계열이 있다.
> SHA 계열은 보안 알고리즘으로 사용하기 위해 고안된 알고리즘이며, SHA-1, SHA-256, SHA-384, SHA-512 등이 있다. MD 계열은 RSA Data Security사에서 고안된 것으로, MD2, MD4, MD5 등이 있다. 해시 함수는 비밀번호와 같은 중요한 정보를 안전하게 저장하기 위해 사용될 수 있다. 일반적으로 비밀번호를 저장할 때에는 암호화를 사용하지 않고, 해시 함수를 이용해 암호화한 값을 저장한다. 이 때, 같은 비밀번호를 입력하면 항상 같은 해시 값이 반환되기 때문에, 입력된 비밀번호와 저장된 해시 값을 비교함으로써 인증을 수행할 수 있다.

- 사용자의 암호를 해싱하여 저장할 때 어떤 식으로 저장하는 것이 보안에 좋을까요?

> 사용자의 암호를 안전하게 저장하기 위해 해시 함수를 사용하여 암호를 해싱하고, 해싱된 암호를 데이터베이스에 저장하는 것이 일반적이다. 그러나 해시 함수로만 암호를 저장한다면, 같은 암호를 입력해도 항상 동일한 해시 값을 반환하기 때문에 보안에 취약할 수 있다. 이러한 문제를 해결하기 위해 해시 함수에 "솔트(salt)"를 추가하여 보안을 강화하는 방법을 사용한다. 솔트는 무작위로 생성된 임의의 데이터로, 원래의 암호와 함께 해싱한다. 따라서 같은 암호라도 다른 솔트값으로 해싱하면 서로 다른 해시값이 생성한다. 이렇게 함으로써 해시값을 훔쳐도 원래 암호를 추론하기 어려워지기 때문에 보안성이 향상된다. 보통은 각각의 사용자마다 고유한 솔트를 생성하여 사용한다.

## Quest

- 이번에는 메모장을 파일이 아닌 DB기반으로 만들어 보고자 합니다.
  - 적절한 테이블을 설계해 보세요.
  - Sequelize를 이용하여 데이터의 모델을 만들고 어플리케이션에 적용해 보세요.
  - 사용자의 비밀번호는 해싱을 통해 저장되어야 합니다.

## Advanced

- Object–relational impedance mismatch란 어떤 개념인가요?
- Foreign Key란 무엇인가요? 이것을 사용할 때의 장점과 단점은 무엇일까요?
- 이전에 쓰이던 해시함수들에는 어떤 것이 있을까요? 패스워드 해싱의 추세의 역사는 어떻게 이어져왔나요?
