# Quest 08. 웹 API의 기초

## Introduction
* 이번 퀘스트에서는 웹 API 서버의 기초를 알아보겠습니다.

## Topics
* HTTP Method
* node.js `http` module
  * `req`와 `res` 객체

## Resources
* [MDN - Content-Type Header](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Type)
* [MDN - HTTP Methods](https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods)
* [MDN - MIME Type](https://developer.mozilla.org/en-US/docs/Glossary/MIME_type)
* [Postman](https://chrome.google.com/webstore/detail/postman/fhbjgbiflinjbdggehcddcbncdddomop)
* [HTTP Node.js Manual & Documentation](https://nodejs.org/api/http.html)

## Checklist
* HTTP의 GET과 POST 메소드는 어떻게 다른가요?

```
HTTP(Hypertext Transfer Protocol)는 인터넷을 통해 데이터를 전송하는 데 사용되는 프로토콜입니다. 가장 일반적으로 사용되는 두 가지 HTTP 메서드는 서로 다른 용도로 사용되는 GET 및 POST입니다.
GET 요청은 서버에서 데이터를 검색하는 데 사용됩니다. 웹 브라우저에 URL을 입력하면 웹 사이트를 호스팅하는 서버에 GET 요청을 보내 해당 URL에 있는 리소스(일반적으로 HTML 문서)를 요청합니다. GET 요청은 링크를 클릭하거나 이미지 또는 기타 리소스가 웹 페이지에 포함된 경우에도 사용됩니다.
GET 요청은 멱등적으로 설계되어 서버 상태를 변경하지 않고 반복될 수 있습니다. 이는 GET 요청이 데이터를 검색할 뿐 수정하지 않기 때문입니다.
반면에 POST 요청은 데이터를 서버로 보내는 데 사용됩니다. 웹 사이트에서 양식을 제출하면 양식 필드에 입력한 데이터와 함께 서버에 POST 요청을 보냅니다. POST 요청은 파일을 업로드하거나 서버에서 데이터를 수정하는 다른 작업을 수행하는 데에도 사용할 수 있습니다.
POST 요청은 멱등적이지 않습니다. 즉, 동일한 요청을 여러 번 반복하면 서버 상태에 따라 다른 결과가 나올 수 있습니다. 이러한 이유로 POST 요청은 일반적으로 데이터베이스에 새 레코드를 추가하거나 기존 레코드를 업데이트하는 것과 같은 부작용이 있는 작업에 사용됩니다.
요약하면 GET 요청은 데이터 검색에 사용되는 반면 POST 요청은 데이터를 수정하거나 작업을 수행하기 위해 서버로 데이터를 보내는 데 사용됩니다.
```

  * 다른 HTTP 메소드에는 무엇이 있나요?
```
  GET: 일반적으로 웹 페이지 또는 이미지나 문서와 같은 리소스와 같은 서버에서 데이터를 검색하는 데 사용됩니다.
  POST: 양식 제출, 파일 업로드 등 리소스를 생성하거나 업데이트하기 위해 서버에 데이터를 보내는 데 사용됩니다.
  PUT: 일반적으로 기존 리소스를 완전히 대체하여 서버의 기존 리소스를 업데이트하는 데 사용됩니다.
  DELETE: 서버의 리소스를 삭제할 때 사용합니다.
  HEAD: GET과 유사하지만 응답 본문이 아닌 응답의 헤더만 검색합니다.
  OPTIONS: 리소스에 사용할 수 있는 통신 옵션에 대한 정보를 검색하는 데 사용됩니다.
  PATCH: 서버의 기존 리소스를 부분적으로 업데이트하는 데 사용됩니다.
```
* HTTP 서버에 GET과 POST를 통해 데이터를 보내려면 어떻게 해야 하나요?
```
GET을 통해 데이터 보내기:
method 속성이 "get"으로 설정되고 action 속성이 데이터를 보낼 서버의 URL로 설정된 HTML 양식을 만듭니다.
보내려는 매개변수의 이름에 해당하는 '이름' 속성을 사용하여 텍스트 입력 또는 확인란과 같은 양식 필드를 양식에 추가합니다.
제출 버튼을 클릭하거나 JavaScript를 사용하여 프로그래밍 방식으로 양식을 제출합니다.
양식이 제출되면 데이터가 URL의 쿼리 매개변수로 인코딩되고 GET 요청을 통해 서버로 전송됩니다.

POST를 통해 데이터 보내기:
method 속성이 "post"로 설정되고 action 속성이 데이터를 보낼 서버의 URL로 설정된 HTML 양식을 만듭니다.
GET 요청과 마찬가지로 양식 필드를 양식에 추가합니다.
제출 버튼을 클릭하거나 JavaScript를 사용하여 프로그래밍 방식으로 양식을 제출합니다.
양식이 제출되면 요청 본문의 데이터와 함께 POST 요청을 통해 데이터가 서버로 전송됩니다. JavaScript를 사용하여 POST를 통해 데이터를 전송하려면 fetch() API 또는 기타 AJAX 라이브러리를 사용하여 프로그래밍 방식으로 HTTP POST 요청을 할 수 있습니다.
```
  * HTTP 요청의 `Content-Type` 헤더는 무엇인가요?
  ```
  Content-Type 헤더는 요청 또는 응답 본문에서 데이터의 MIME 유형을 지정하는 표준 HTTP 헤더입니다. 수신자가 데이터를 적절하게 구문 분석하고 처리할 수 있도록 전송되는 데이터 유형을 서버 또는 클라이언트에 알려줍니다.
  예를 들어 요청의 Content-Type 헤더가 application/json으로 설정되어 있으면 요청 본문에 JSON 형식의 데이터가 포함되어 있음을 나타냅니다. 마찬가지로 응답의 Content-Type 헤더가 text/html로 설정되면 응답 본문에 HTML 콘텐츠가 포함되어 있음을 나타냅니다.
  'Content-Type' 헤더는 일반적으로 요청을 보내는 클라이언트 또는 응답을 보내는 서버에 의해 설정됩니다. 경우에 따라 'Content-Type' 헤더는 파일 확장자 또는 데이터의 기타 특성에 따라 요청 또는 응답을 처리하는 소프트웨어에 의해 자동으로 설정될 수 있습니다.
  'Content-Type' 헤더를 올바르게 설정하는 것이 중요합니다. 수신자가 데이터를 제대로 처리하고 표시하는 데 도움이 되기 때문입니다. 'Content-Type' 헤더가 올바르지 않거나 누락된 경우 수신자가 데이터를 제대로 처리할 수 없어 오류가 발생하거나 콘텐츠가 잘못 표시될 수 있습니다.
  ```
  * Postman에서 POST 요청을 보내는 여러 가지 방법(`form-data`, `x-www-form-urlencoded`, `raw`, `binary`) 각각은 어떤 용도를 가지고 있나요?
```
  form-data: 이 방법은 일반적으로 파일을 업로드하거나 파일이 포함된 양식을 제출하는 데 사용되는 multipart/form-data 형식으로 데이터를 보내는 데 사용됩니다. 데이터는 키-값 쌍으로 전송되며 여기서 키는 양식 필드의 이름을 나타내고 값은 해당 필드에 입력된 데이터를 나타냅니다.
  x-www-form-urlencoded: 이 방법은 HTTP POST 요청을 통해 데이터를 전송하기 위한 표준 형식인 application/x-www-form-urlencoded 형식으로 데이터를 전송하는 데 사용됩니다. 데이터는 키-값 쌍으로 전송되며 여기서 키는 양식 필드의 이름을 나타내고 값은 해당 필드에 입력된 데이터를 나타냅니다.
  raw: 이 방법은 JSON 또는 XML과 같은 원시 형식으로 데이터를 보내는 데 사용됩니다. 데이터는 서식이나 인코딩 없이 요청 본문에 직접 입력됩니다.
  binary: 이 메소드는 이미지나 오디오 파일과 같은 바이너리 데이터를 요청 본문으로 보내는 데 사용됩니다. 데이터는 이진 스트림으로 인코딩되어 요청 본문에 직접 전송됩니다.
  일반적으로 사용할 방법의 선택은 전송되는 데이터 유형과 사용 중인 API의 요구 사항에 따라 다릅니다. 예를 들어 파일을 업로드해야 하는 경우에는 form-data 방식을 사용하고 JSON 데이터를 보내야 하는 경우에는 raw 방식을 사용합니다. x-www-form-urlencoded 방법은 일반적으로 파일을 포함하지 않는 간단한 양식에 사용되는 반면 binary 방법은 이진 데이터를 보내는 데 사용됩니다.
```
* node.js의 `http` 모듈을 통해 HTTP 요청을 처리할 때,
  * `req`와 `res` 객체에는 어떤 정보가 담겨있을까요?
```
  1. req: 클라이언트로부터 들어오는 요청에 대한 정보를 포함하는 HTTP 요청 객체입니다. 다음 속성을 포함합니다.
  req.method: 요청을 만들기 위해 클라이언트가 사용하는 HTTP 메서드(예: GET, POST 등)
  req.url: 요청된 리소스의 URL
  req.headers: 요청 헤더를 포함하는 객체
  req.body: 요청 본문(있는 경우)(이 속성은 기본적으로 사용할 수 없으며 원시 데이터에서 구문 분석해야 함)

  2. res: 클라이언트에게 응답을 다시 보내는 데 사용되는 HTTP 응답 개체입니다. 여기에는 다음 속성 및 메서드가 포함됩니다.
  res.statusCode: 클라이언트로 다시 보낼 HTTP 상태 코드(예: 200은 OK, 404는 찾을 수 없음 등)
  res.setHeader(name, value): 클라이언트에 보낼 응답의 헤더를 설정합니다.
  res.write(data): 응답 본문에 데이터 쓰기
  res.end([data]): 선택적으로 응답 본문의 일부 데이터와 함께 클라이언트에 응답을 보냅니다.

  * GET과 POST에 대한 처리 형태가 달라지는 이유는 무엇인가요?
  GET 요청은 서버에서 리소스를 검색하는 데 사용되며 일반적으로 요청 본문이 없습니다. 따라서 GET 요청을 처리할 때 서버는 URL에서 쿼리 매개변수를 읽고 요청된 리소스를 반환합니다. GET 요청 처리는 일반적으로 간단합니다.
  POST 요청은 서버에 데이터를 제출하는 데 사용되며 일반적으로 제출할 데이터가 포함된 요청 본문이 있습니다. 따라서 POST 요청을 처리할 때 서버는 요청 본문에서 데이터를 읽고 구문 분석하고 그에 따라 처리해야 합니다. POST 요청 처리는 일반적으로 더 복잡하며 들어오는 데이터를 처리하기 위한 추가 작업이 필요합니다.
  요약하면 GET 및 POST 요청에 대한 처리 유형은 용도와 특성이 다르기 때문에 서로 다릅니다. GET 요청은 리소스 검색에 사용되는 반면 POST 요청은 데이터 제출에 사용되며 각 유형에 대한 처리는 특정 사용 사례에 맞게 조정됩니다.
```
* 만약 API 엔드포인트(URL)가 아주 많다고 한다면, HTTP POST 요청의 `Content-Type` 헤더에 따라 다른 방식으로 동작하는 서버를 어떻게 정리하면 좋을까요?
```
1. 별도의 엔드포인트 사용: 지원해야 하는 각 Content-Type 헤더에 대해 별도의 API 엔드포인트를 생성할 수 있습니다. 이 접근 방식은 Content-Type 헤더에 따라 서버의 동작이 크게 달라지거나 지원할 헤더 수가 제한된 경우에 잘 작동합니다.

2. 미들웨어 사용: 미들웨어를 사용하여 들어오는 요청을 처리하고 Content-Type 헤더를 기반으로 적절한 핸들러로 라우팅할 수 있습니다. 이 접근 방식은 지원할 헤더가 많거나 헤더에 따라 서버의 동작이 약간만 다른 경우에 적합합니다.

3. 콘텐츠 협상 사용: 콘텐츠 협상을 사용하여 'Content-Type' 헤더를 기반으로 적절한 동작을 결정할 수 있습니다. 콘텐츠 협상은 클라이언트와 서버가 통신하여 반환할 리소스의 최상의 표현을 결정하는 프로세스입니다. 이 접근 방식은 지원할 헤더가 많고 헤더에 따라 서버의 동작이 약간만 다른 경우에 잘 작동합니다.

어떤 접근 방식을 선택하든 개발자가 API와 상호 작용하는 방법과 Content-Type 헤더를 기반으로 예상되는 동작을 알 수 있도록 API가 잘 문서화되어 있는지 확인하는 것이 중요합니다.
```
  * 그 밖에 서버가 요청들에 따라 공통적으로 처리하는 일에는 무엇이 있을까요? 이를 어떻게 정리하면 좋을까요?
```
요청을 처리하는 것 외에도 서버는 일반적으로 인증 처리, 로깅, 오류 처리 및 캐싱과 같은 다른 작업도 수행합니다. 이러한 작업을 정리하기 위해 미들웨어를 사용하는 것이 일반적입니다.

미들웨어는 서버와 클라이언트 사이에 위치하며 다양한 작업을 수행하기 위해 요청과 응답을 가로챌 수 있는 소프트웨어입니다. 서버에 기능을 추가하거나 오류를 처리하거나 응답을 수정하는 데 사용할 수 있습니다.

미들웨어를 구성하는 가장 일반적인 접근 방식은 미들웨어 스택을 사용하는 것입니다. 미들웨어 스택은 들어오는 각 요청에 대해 순서대로 실행되는 미들웨어 기능의 정렬된 목록입니다. 스택의 각 미들웨어 기능은 요청 및 응답 개체에 액세스할 수 있으며 필요에 따라 수정할 수 있습니다.

미들웨어 기능은 인증 미들웨어, 오류 처리 미들웨어 및 로깅 미들웨어와 같은 목적에 따라 다른 그룹으로 구성할 수 있습니다. 미들웨어를 그룹으로 구성하면 코드를 체계적으로 유지하고 쉽게 유지 관리할 수 있습니다.

미들웨어를 구성할 때 고려해야 할 또 다른 중요한 사항은 미들웨어 기능이 실행되는 순서입니다. 순서는 서버의 동작에 상당한 영향을 미칠 수 있으므로 실행 순서를 신중하게 고려하는 것이 중요합니다.

요약하면 서버는 요청 처리 외에도 다양한 작업을 수행하며 미들웨어를 사용하여 이러한 작업을 구성할 수 있습니다. 미들웨어 스택을 사용하고 미들웨어 기능을 그룹으로 구성하면 코드를 체계적으로 유지 관리할 수 있습니다. 또한 미들웨어 기능이 실행되는 순서를 신중하게 고려하는 것이 중요합니다.
```
## Quest
* 다음의 동작을 하는 서버를 만들어 보세요.
  * 브라우저의 주소창에 `http://localhost:8080`을 치면 `Hello World!`를 응답하여 브라우저에 출력합니다.
  * 서버의 `/foo` URL에 `bar` 변수로 임의의 문자열을 GET 메소드로 보내면, `Hello, [문자열]`을 출력합니다.
  * 서버의 `/foo` URL에 `bar` 키에 임의의 문자열 값을 갖는 JSON 객체를 POST 메소드로 보내면, `Hello, [문자열]`을 출력합니다.
  * 서버의 `/pic/upload` URL에 그림 파일을 POST 하면 서버에 보안상 적절한 방법으로 파일이 업로드 됩니다.
  * 서버의 `/pic/show` URL을 GET 하면 브라우저에 위에 업로드한 그림이 뜹니다.
  * 서버의 `/pic/download` URL을 GET 하면 브라우저에 위에 업로드한 그림이 `pic.jpg`라는 이름으로 다운로드 됩니다.
* expressJS와 같은 외부 프레임워크를 사용하지 않고, node.js의 기본 모듈만을 사용해서 만들어 보세요.
* 처리하는 요청의 종류에 따라 공통적으로 나타나는 코드를 정리해 보세요.

## Advanced
* 서버가 파일 업로드를 지원할 때 보안상 주의할 점에는 무엇이 있을까요?
